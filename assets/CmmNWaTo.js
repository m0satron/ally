import{_ as D}from"./DfjnnZpM.js";import{m as L,p as F,o as k,c as g,F as P,y as R,q as V,v as y,a as x,t as B,u as $,I as z,_ as G,N as j,r as m}from"./BLcmtekx.js";import{l as A,R as H,w as v,N as J,u as K}from"./CWfz57DC.js";const M={class:"title"},O={class:"description"},Q=["src"],T=L({__name:"Desktop",props:{title:{},description:{},categories:{},url:{},color:{},image:{},locale:{},slug:{}},setup(n){const t=n,i=F(()=>{if(!t.description)return"";const e=200;return t.description.length>e?t.description.slice(0,e)+"...":t.description});return(e,o)=>{var a;const _=D;return k(),g("div",{class:z(["card",[t.url&&"hoverable",t.color||"primary"]])},[(a=t.categories)!=null&&a.length?(k(!0),g(P,{key:0},R(t.categories,s=>(k(),V(_,{key:s,label:s,class:"chip"},null,8,["label"]))),128)):y("",!0),x("h2",M,B(t.title),1),x("p",O,B($(i)),1),e.image?(k(),g("img",{key:1,src:e.image,class:"image"},null,8,Q)):y("",!0)],2)}}}),ee=G(T,[["__scopeId","data-v-d64e704d"]]),b=A("https://fari-cms.directus.app").with(H()),te=j("buildingBlocks",()=>{const n=m(null),t=m(!1),i=m([]),e=m();async function o(){const s=await b.request(v("ally_building_block",{fields:["*.*"],filter:{status:{_eq:"published"}}}));i.value=await Promise.all(s.map(l=>(l==null||delete l.alternative_building_blocks,l)).map(h))}async function _(s){var l;if(e.value&&((l=e.value)==null?void 0:l.id)===s)return e.value;if(!i.value)return await a(s);if(i.value){const c=i.value.find(p=>p.id===s);return c?e.value=c:await a(s),e.value}}async function a(s){let l=[];const c=[];let p;const u=await b.request(J("ally_building_block",s,{fields:["*.*"],filter:{status:{_eq:"published"}}}));if(u.external_links&&u.external_links.length){const d=u.external_links.map(({ally_external_link_slug:r})=>r);l=await b.request(v("ally_external_link",{fields:["*.*"],filter:{slug:{_in:d}}}))}if(u.alternative_building_blocks&&u.alternative_building_blocks.length){const d=u.alternative_building_blocks.map(({related_ally_building_block_id:r})=>r);p=await b.request(v("ally_building_block",{fields:["*.*"],filter:{id:{_in:d},status:{_eq:"published"}}})),c==null||delete c.alternative_building_blocks}e.value=await h({...u,alternative_building_blocks:c,alternatives:p,external_links:l}),console.log(e.value)}return{blocks:i,selectedBlock:e,error:n,loading:t,findBlock:_,getBlock:a,getBlocks:o}});async function h(n){var w;console.log({buildingBlock:n});const{id:t,cost:i,effort:e,involvement:o,time:_,maintenance:a,category:s,translations:l,alternative_building_blocks:c=[],alternatives:p=[],external_links:u}=n,{findBuildingBlockCategory:d}=K(),r={title:{},description:{},benefits:{},how_to_execute:{},kpis:{}},q=await d(s==null?void 0:s.slug);return l.forEach(({title:C,description:E,benefits:N,how_to_execute:I,kpis:S,languages_code:f})=>{r.title[f]=C,r.description[f]=E,r.benefits[f]=N,r.how_to_execute[f]=I,r.kpis[f]=S}),console.log({alternative_building_blocks:c}),{id:t,cost:i,effort:e,involvement:W((w=o==null?void 0:o.blocks[0])==null?void 0:w.data),time:_,maintenance:a,category:q,alternative_building_blocks:await Promise.all(p.map(h)),external_links:u.map(U),...r}}function U(n){const{url:t,slug:i,translations:e}=n,o={url:t,slug:i,title:{},description:{}};return e==null||e.forEach(({languages_code:_,title:a,description:s,long_description:l})=>{o.title[_]=a,console.log(l),o.description[_]=s||l}),o}function W(n){if(!n)return null;let t="";return n==null||n.items.forEach(({content:i})=>{t=`${t} 
 ${i}`}),t}export{ee as _,te as u};
