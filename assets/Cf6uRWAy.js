import{l as w,R as k,w as _,N as m}from"./CWfz57DC.js";import{N as y,r as u}from"./BLcmtekx.js";import{u as C}from"./CmmNWaTo.js";const f=w("https://fari-cms.directus.app").with(k()),x=y("cases",()=>{const o=u(null),d=u(!1),n=u([]),l=u();async function c(){const e=await f.request(_("ally_case",{fields:["*.*"]}));n.value=await Promise.all(e.map(a=>(a==null||delete a.alternative_cases,a)).map(v))}async function i(e){var a;if(l.value&&((a=l.value)==null?void 0:a.id)===e)return l.value;if(!n.value)return await r(e);if(n.value){const t=n.value.find(s=>s.id===e);return t?l.value=t:await r(e),l.value}}async function r(e){let a=[],t=[];const s=await f.request(m("ally_case",e,{fields:["*.*"]}));s.external_links&&s.external_links.length&&(a=await f.request(_("ally_external_link",{fields:["*.*"]}))),s.alternative_cases&&s.alternative_cases.length&&(t=await f.request(_("ally_case",{fields:["*.*"],filter:{id:{_in:s.alternative_cases.map(({id:p})=>p)||[]}}}))),t==null||delete t.alternative_cases,l.value=await v({...s,alternative_cases:t,external_links:a})}return{cases:n,selectedCase:l,error:o,loading:d,findCase:i,getCase:r,getCases:c}});async function v(o){console.log({caseItem:o});const{id:d,translations:n,alternative_cases:l=[],building_blocks_used:c}=o,i={title:{},description:{},content:{}},{findBlock:r}=C();return n.forEach(({title:e,description:a,content:t,languages_code:s})=>{i.title[s]=e,i.description[s]=a,i.content[s]=t}),{id:d,alternative_cases:await Promise.all(l.map(v)),...i,building_blocks_used:c?await Promise.all(c.map(({id:e})=>r(e))):[]}}export{x as u};
